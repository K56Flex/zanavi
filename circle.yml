machine:
  timezone:
    Europe/Vienna
dependencies:
  cache_directories:
    - ~/.android
  pre:
    - sudo apt-get update
    - sudo apt-get install libpng12-dev
    - sudo apt-get install librsvg2-bin 
    - sudo apt-get install libfreetype6-dev
    - sudo apt-get install libdbus-glib-1-dev
    - sudo apt-get install g++
    - sudo apt-get install gettext
    # - sudo apt-get install openjdk-8-jdk
    - sudo apt-get install ant
    - sudo apt-get install libsaxonb-java
    - sudo apt-get install lib32stdc++6
    - sudo apt-get install lib32z1
    - bash ci/do_android.sh
test:
  pre:
    - mksdcard -l e 20000M sdcard.img
    - emulator -avd circleci-android21 -sdcard sdcard.img -no-audio -no-window:
        background: true
        parallel: true
    - circle-android wait-for-boot
  override:
    - ls -al ~/android-build/navit/android/bin/
    # - adb install ~/android-build/navit/android/bin/zanavi_debug_signed_aligned.apk
    - ls -al $CIRCLE_ARTIFACTS/
    - adb install $CIRCLE_ARTIFACTS/zanavi_circleci_$CIRCLE_SHA1.apk
    - fb-adb shell "pwd"
    - fb-adb shell "ls -al /"
    - fb-adb shell "df"
    - fb-adb shell "df /storage/sdcard/"

    - wget --no-check-certificate -t 10 -O ~/navitmap_001.bin "http://zanavi.weidestraat.nl/data/austria.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_002.bin "http://zanavi.weidestraat.nl/data/germany.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_003.bin "http://zanavi.weidestraat.nl/data/netherlands.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_004.bin "http://zanavi.weidestraat.nl/data/belgium.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_005.bin "http://zanavi.weidestraat.nl/data/france.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_006.bin "http://zanavi.weidestraat.nl/data/italy.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_007.bin "http://zanavi.weidestraat.nl/data/liechtenstein.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_008.bin "http://zanavi.weidestraat.nl/data/luxembourg.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_009.bin "http://zanavi.weidestraat.nl/data/switzerland.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_010.bin "http://zanavi.weidestraat.nl/data/great_britain.bin"
    - wget --no-check-certificate -t 10 -O ~/navitmap_011.bin "http://zanavi.weidestraat.nl/data/ireland.bin"

    - mkdir ~/yaml-tests/
    - wget -t 10 -O ~/yaml-tests/yaml.zip "https://github.com/navit-gps/routing-qa/archive/master.zip"
    - cd ~/yaml-tests/ && unzip yaml.zip && cd ~/
    - fb-adb shell "mkdir -p /storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/../../debug/../yamltests/"
    - for i in `ls -1 ~/yaml-tests/routing-qa-master/*.yaml` ; do fb-adb push "$i" "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/../../debug/../yamltests/" ; done

    - fb-adb shell "mkdir -p /storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb shell "ls -al /storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/"

    - fb-adb push ~/navitmap_001.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_002.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_003.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_004.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_005.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_006.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_007.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_008.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_009.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_010.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"
    - fb-adb push ~/navitmap_011.bin "/storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"

    - fb-adb shell "ls -al /storage/sdcard/Android/data/com.zoffcc.applications.zanavi/files/zanavi/maps/zanavi/maps/"

    - fb-adb shell am start -n com.zoffcc.applications.zanavi/com.zoffcc.applications.zanavi.Navit

    - fb-adb shell "ls -alR /storage/sdcard/Android/data/com.zoffcc.applications.zanavi/"

    - sleep 60
    - fb-adb shell am force-stop com.zoffcc.applications.zanavi
    - sleep 5
    - fb-adb shell am start -n com.zoffcc.applications.zanavi/com.zoffcc.applications.zanavi.Navit





